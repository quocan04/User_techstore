<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riêng tư & Bảo mật - E-Commerce Admin</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
        }

        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            color: white !important;
            font-weight: 600;
            font-size: 1.3rem;
        }

        .container-main {
            max-width: 900px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .page-header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .page-header h1 {
            margin: 0;
            color: #1f2937;
            font-weight: 600;
        }

        .page-header .breadcrumb {
            margin-top: 15px;
            margin-bottom: 0;
            background: transparent;
            padding: 0;
        }

        .content-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 15px;
        }

        .section-description {
            color: #6b7280;
            margin-bottom: 25px;
        }

        .privacy-option {
            background: #f9fafb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #e5e7eb;
            transition: all 0.3s;
        }

        .privacy-option:hover {
            border-color: #667eea;
            background: #fafbff;
        }

        .privacy-option-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }

        .privacy-option-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 5px;
        }

        .form-switch {
            padding-left: 2.5em;
        }

        .form-switch .form-check-input {
            width: 3em;
            height: 1.5em;
            cursor: pointer;
        }

        .form-switch .form-check-input:checked {
            background-color: #667eea;
            border-color: #667eea;
        }

        .two-factor-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .two-factor-status {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .status-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .status-icon.inactive {
            background: #fee2e2;
            color: #dc2626;
        }

        .status-icon.active {
            background: #d1fae5;
            color: #059669;
        }

        .status-info h4 {
            margin: 0;
            font-weight: 600;
            color: #1f2937;
        }

        .badge-status {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
            margin-top: 5px;
        }

        .badge-active {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-inactive {
            background: #fee2e2;
            color: #991b1b;
        }

        .qr-code-container {
            text-align: center;
            padding: 30px;
            background: #f9fafb;
            border-radius: 12px;
            margin: 25px 0;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e5e7eb;
        }

        .secret-key {
            background: white;
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .secret-key-text {
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            font-weight: 600;
            color: #667eea;
            letter-spacing: 2px;
        }

        .verification-input {
            max-width: 300px;
            margin: 20px auto;
        }

        .verification-input input {
            text-align: center;
            font-size: 1.5rem;
            letter-spacing: 10px;
            font-weight: 600;
        }

        .backup-codes {
            background: #f9fafb;
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
        }

        .backup-codes-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .backup-code {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #374151;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-outline-primary {
            border: 2px solid #667eea;
            color: #667eea;
            padding: 12px 30px;
            border-radius: 10px;
            font-weight: 600;
            background: white;
        }

        .btn-outline-primary:hover {
            background: #667eea;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-weight: 600;
        }

        .alert {
            border-radius: 10px;
            border: none;
            margin-bottom: 25px;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e5e7eb;
            z-index: 0;
        }

        .step {
            position: relative;
            z-index: 1;
            text-align: center;
            flex: 1;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 2px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: 600;
            color: #9ca3af;
        }

        .step.active .step-circle {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .step.completed .step-circle {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .step-label {
            font-size: 0.85rem;
            color: #6b7280;
            font-weight: 500;
        }

        .step.active .step-label {
            color: #667eea;
            font-weight: 600;
        }

        .divider {
            height: 1px;
            background: #e5e7eb;
            margin: 30px 0;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="/dashboard">
            <i class="bi bi-shop me-2"></i>E-Commerce Admin
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link text-white" href="/settings">
                        <i class="bi bi-arrow-left me-1"></i>Quay lại Settings
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white" href="/logout">
                        <i class="bi bi-box-arrow-right me-1"></i>Đăng xuất
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container-main">
    <div class="page-header">
        <h1><i class="bi bi-shield-lock-fill me-2"></i>Riêng tư & Bảo mật</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="/settings">Cài đặt</a></li>
                <li class="breadcrumb-item active">Riêng tư & Bảo mật</li>
            </ol>
        </nav>
    </div>

    <!-- Privacy Settings -->
    <div class="content-card">
        <h2 class="section-title">
            <i class="bi bi-eye-slash me-2"></i>Cài đặt riêng tư
        </h2>
        <p class="section-description">Kiểm soát ai có thể xem thông tin của bạn</p>

        <div class="privacy-option">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="privacy-option-title">Hiển thị hồ sơ công khai</div>
                    <small class="text-muted">Cho phép người khác xem hồ sơ của bạn</small>
                </div>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="publicProfile" checked>
                </div>
            </div>
        </div>

        <div class="privacy-option">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="privacy-option-title">Hiển thị email</div>
                    <small class="text-muted">Cho phép người khác xem địa chỉ email của bạn</small>
                </div>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="showEmail">
                </div>
            </div>
        </div>

        <div class="privacy-option">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="privacy-option-title">Hiển thị số điện thoại</div>
                    <small class="text-muted">Cho phép người khác xem số điện thoại của bạn</small>
                </div>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="showPhone">
                </div>
            </div>
        </div>

        <div class="privacy-option">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="privacy-option-title">Hoạt động trực tuyến</div>
                    <small class="text-muted">Hiển thị trạng thái trực tuyến của bạn</small>
                </div>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="onlineStatus" checked>
                </div>
            </div>
        </div>

        <div class="privacy-option">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="privacy-option-title">Lịch sử đơn hàng</div>
                    <small class="text-muted">Hiển thị lịch sử mua hàng của bạn</small>
                </div>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="orderHistory">
                </div>
            </div>
        </div>

        <button type="button" class="btn btn-primary mt-3">
            <i class="bi bi-check2 me-2"></i>Lưu cài đặt riêng tư
        </button>
    </div>

    <!-- 2FA Section -->
    <div class="content-card">
        <h2 class="section-title">
            <i class="bi bi-shield-check me-2"></i>Xác thực hai yếu tố (2FA)
        </h2>
        <p class="section-description">Tăng cường bảo mật tài khoản với xác thực hai yếu tố</p>

        <!-- 2FA Status -->
        <div class="two-factor-card" id="twoFactorStatus">
            <div class="two-factor-status">
                <div class="status-icon inactive">
                    <i class="bi bi-shield-x"></i>
                </div>
                <div class="status-info">
                    <h4>Xác thực hai yếu tố</h4>
                    <span class="badge-status badge-inactive">Chưa kích hoạt</span>
                </div>
            </div>
            <p class="text-muted mb-3">
                Xác thực hai yếu tố thêm một lớp bảo mật bổ sung cho tài khoản của bạn.
                Ngoài mật khẩu, bạn sẽ cần nhập mã xác thực từ ứng dụng để đăng nhập.
            </p>
            <button type="button" class="btn btn-primary" onclick="startTwoFactorSetup()">
                <i class="bi bi-shield-plus me-2"></i>Kích hoạt 2FA
            </button>
        </div>

        <!-- 2FA Setup Process (Hidden by default) -->
        <div id="twoFactorSetup" style="display: none;">
            <div class="step-indicator">
                <div class="step active" id="step1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Tải ứng dụng</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Quét mã QR</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Xác minh</div>
                </div>
                <div class="step" id="step4">
                    <div class="step-circle">4</div>
                    <div class="step-label">Hoàn tất</div>
                </div>
            </div>

            <!-- Step 1: Download App -->
            <div class="setup-step" id="setupStep1">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>Bước 1:</strong> Tải ứng dụng xác thực
                </div>
                <p>Tải một trong các ứng dụng xác thực sau về điện thoại của bạn:</p>
                <div class="row g-3 mb-4">
                    <div class="col-md-4">
                        <div class="privacy-option text-center">
                            <i class="bi bi-google text-primary fs-1 mb-2"></i>
                            <div class="privacy-option-title">Google Authenticator</div>
                            <small class="text-muted">iOS & Android</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="privacy-option text-center">
                            <i class="bi bi-microsoft text-primary fs-1 mb-2"></i>
                            <div class="privacy-option-title">Microsoft Authenticator</div>
                            <small class="text-muted">iOS & Android</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="privacy-option text-center">
                            <i class="bi bi-shield-check text-primary fs-1 mb-2"></i>
                            <div class="privacy-option-title">Authy</div>
                            <small class="text-muted">iOS & Android</small>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-primary" onclick="nextStep(2)">
                    Tiếp theo <i class="bi bi-arrow-right ms-2"></i>
                </button>
            </div>

            <!-- Step 2: Scan QR Code -->
            <div class="setup-step" id="setupStep2" style="display: none;">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>Bước 2:</strong> Quét mã QR bằng ứng dụng xác thực
                </div>
                <div class="qr-code-container">
                    <div class="qr-code">
                        <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                            <rect width="200" height="200" fill="white"/>
                            <rect x="10" y="10" width="30" height="30" fill="black"/>
                            <rect x="50" y="10" width="10" height="10" fill="black"/>
                            <rect x="70" y="10" width="20" height="20" fill="black"/>
                            <rect x="100" y="10" width="10" height="10" fill="black"/>
                            <rect x="160" y="10" width="30" height="30" fill="black"/>
                            <rect x="10" y="50" width="10" height="10" fill="black"/>
                            <rect x="30" y="50" width="10" height="10" fill="black"/>
                            <rect x="50" y="50" width="20" height="20" fill="black"/>
                            <rect x="120" y="50" width="10" height="10" fill="black"/>
                            <rect x="160" y="50" width="10" height="10" fill="black"/>
                            <rect x="180" y="50" width="10" height="10" fill="black"/>
                            <rect x="10" y="160" width="30" height="30" fill="black"/>
                            <rect x="50" y="160" width="10" height="10" fill="black"/>
                            <rect x="70" y="160" width="20" height="20" fill="black"/>
                            <rect x="160" y="160" width="30" height="30" fill="black"/>
                        </svg>
                    </div>
                    <p class="text-muted">Mở ứng dụng xác thực và quét mã QR này</p>
                </div>

                <div class="secret-key">
                    <p class="mb-2"><strong>Hoặc nhập mã thủ công:</strong></p>
                    <div class="secret-key-text">JBSW Y3DP EHPK 3PXP</div>
                    <button class="btn btn-sm btn-outline-primary mt-2" onclick="copySecretKey()">
                        <i class="bi bi-clipboard me-1"></i>Sao chép
                    </button>
                </div>

                <div class="text-center">
                    <button type="button" class="btn btn-outline-primary me-2" onclick="prevStep(1)">
                        <i class="bi bi-arrow-left me-2"></i>Quay lại
                    </button>
                    <button type="button" class="btn btn-primary" onclick="nextStep(3)">
                        Tiếp theo <i class="bi bi-arrow-right ms-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: Verify Code -->
            <div class="setup-step" id="setupStep3" style="display: none;">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>Bước 3:</strong> Xác minh mã từ ứng dụng
                </div>
                <p class="text-center mb-4">Nhập mã 6 chữ số từ ứng dụng xác thực của bạn</p>

                <div class="verification-input">
                    <input type="text" class="form-control" id="verificationCode"
                           maxlength="6" placeholder="000000">
                </div>

                <div class="alert alert-danger d-none" id="verificationError">
                    <i class="bi bi-x-circle me-2"></i>
                    Mã xác thực không đúng. Vui lòng thử lại.
                </div>

                <div class="text-center">
                    <button type="button" class="btn btn-outline-primary me-2" onclick="prevStep(2)">
                        <i class="bi bi-arrow-left me-2"></i>Quay lại
                    </button>
                    <button type="button" class="btn btn-primary" onclick="verifyCode()">
                        Xác minh <i class="bi bi-check2 ms-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 4: Backup Codes -->
            <div class="setup-step" id="setupStep4" style="display: none;">
                <div class="alert alert-success">
                    <i class="bi bi-check-circle me-2"></i>
                    <strong>Hoàn tất!</strong> Xác thực hai yếu tố đã được kích hoạt thành công.
                </div>

                <div class="backup-codes">
                    <h5 class="mb-3"><i class="bi bi-key me-2"></i>Mã dự phòng</h5>
                    <p class="text-muted">
                        Lưu các mã này ở nơi an toàn. Bạn có thể sử dụng chúng để đăng nhập
                        nếu mất quyền truy cập vào ứng dụng xác thực.
                    </p>
                    <div class="backup-codes-grid">
                        <div class="backup-code">1A2B-3C4D</div>
                        <div class="backup-code">5E6F-7G8H</div>
                        <div class="backup-code">9I0J-1K2L</div>
                        <div class="backup-code">3M4N-5O6P</div>
                        <div class="backup-code">7Q8R-9S0T</div>
                        <div class="backup-code">1U2V-3W4X</div>
                        <div class="backup-code">5Y6Z-7A8B</div>
                        <div class="backup-code">9C0D-1E2F</div>
                    </div>
                    <button class="btn btn-outline-primary mt-3 w-100" onclick="downloadBackupCodes()">
                        <i class="bi bi-download me-2"></i>Tải xuống mã dự phòng
                    </button>
                </div>

                <div class="text-center mt-4">
                    <button type="button" class="btn btn-primary" onclick="completeTwoFactorSetup()">
                        <i class="bi bi-check-circle me-2"></i>Hoàn tất thiết lập
                    </button>
                </div>
            </div>
        </div>

        <!-- 2FA Active State (Hidden by default) -->
        <div id="twoFactorActive" style="display: none;">
            <div class="two-factor-card">
                <div class="two-factor-status">
                    <div class="status-icon active">
                        <i class="bi bi-shield-check"></i>
                    </div>
                    <div class="status-info">
                        <h4>Xác thực hai yếu tố</h4>
                        <span class="badge-status badge-active">Đang kích hoạt</span>
                    </div>
                </div>
                <p class="text-muted mb-3">
                    Tài khoản của bạn được bảo vệ bằng xác thực hai yếu tố.
                    Kích hoạt từ: <strong>15/11/2025</strong>
                </p>
                <button type="button" class="btn btn-outline-primary me-2" onclick="showBackupCodes()">
                    <i class="bi bi-key me-2"></i>Xem mã dự phòng
                </button>
                <button type="button" class="btn btn-danger" onclick="disableTwoFactor()">
                    <i class="bi bi-shield-x me-2"></i>Tắt 2FA
                </button>
            </div>
        </div>
    </div>

    <!-- Data & Privacy -->
    <div class="content-card">
        <h2 class="section-title">
            <i class="bi bi-database me-2"></i>Dữ liệu & Quyền riêng tư
        </h2>
        <p class="section-description">Quản lý dữ liệu cá nhân của bạn</p>

        <div class="privacy-option mb-3">
            <div class="privacy-option-title">
                <i class="bi bi-download me-2"></i>Tải xuống dữ liệu của bạn
            </div>
            <p class="text-muted mb-2">Nhận một bản sao dữ liệu cá nhân của bạn</p>
            <button class="btn btn-outline-primary">
                <i class="bi bi-file-earmark-arrow-down me-2"></i>Yêu cầu tải xuống
            </button>
        </div>

        <div class="privacy-option">
            <div class="privacy-option-title text-danger">
                <i class="bi bi-trash me-2"></i>Xóa tất cả dữ liệu
            </div>
            <p class="text-muted mb-2">Xóa vĩnh viễn tất cả dữ liệu của bạn khỏi hệ thống</p>
            <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteDataModal">
                <i class="bi bi-trash me-2"></i>Xóa dữ liệu
            </button>
        </div>
    </div>
</div>

<!-- Delete Data Modal -->
<div class="modal fade" id="deleteDataModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 15px;">
            <div class="modal-header border-0">
                <h5 class="modal-title text-danger">
                    <i class="bi bi-exclamation-triangle me-2"></i>Xác nhận xóa dữ liệu
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn xóa tất cả dữ liệu? Hành động này không thể hoàn tác.</p>
                <p class="text-danger mb-0"><strong>Mọi thông tin, đơn hàng và lịch sử của bạn sẽ bị xóa vĩnh viễn.</strong></p>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-danger">Xóa tất cả dữ liệu</button>
            </div>
        </div>
    </div>
</div>

<!-- Backup Codes Modal -->
<div class="modal fade" id="backupCodesModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 15px;">
            <div class="modal-header border-0">
                <h5 class="modal-title">
                    <i class="bi bi-key me-2"></i>Mã dự phòng
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    Mỗi mã chỉ có thể sử dụng một lần. Vui lòng lưu trữ an toàn.
                </div>
                <div class="backup-codes-grid">
                    <div class="backup-code">1A2B-3C4D</div>
                    <div class="backup-code">5E6F-7G8H</div>
                    <div class="backup-code">9I0J-1K2L</div>
                    <div class="backup-code">3M4N-5O6P</div>
                    <div class="backup-code">7Q8R-9S0T</div>
                    <div class="backup-code">1U2V-3W4X</div>
                    <div class="backup-code">5Y6Z-7A8B</div>
                    <div class="backup-code">9C0D-1E2F</div>
                </div>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" onclick="downloadBackupCodes()">
                    <i class="bi bi-download me-2"></i>Tải xuống
                </button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Two Factor Setup Functions
    function startTwoFactorSetup() {
        document.getElementById('twoFactorStatus').style.display = 'none';
        document.getElementById('twoFactorSetup').style.display = 'block';
        document.getElementById('setupStep1').style.display = 'block';
    }

    function nextStep(stepNumber) {
        // Hide all steps
        for (let i = 1; i <= 4; i++) {
            document.getElementById('setupStep' + i).style.display = 'none';
            document.getElementById('step' + i).classList.remove('active', 'completed');
        }

        // Show current step
        document.getElementById('setupStep' + stepNumber).style.display = 'block';
        document.getElementById('step' + stepNumber).classList.add('active');

        // Mark previous steps as completed
        for (let i = 1; i < stepNumber; i++) {
            document.getElementById('step' + i).classList.add('completed');
        }
    }

    function prevStep(stepNumber) {
        nextStep(stepNumber);
    }

    function copySecretKey() {
        const secretKey = 'JBSWY3DPEHPK3PXP';
        navigator.clipboard.writeText(secretKey).then(() => {
            alert('Mã bí mật đã được sao chép!');
        });
    }

    function verifyCode() {
        const code = document.getElementById('verificationCode').value;
        const errorAlert = document.getElementById('verificationError');

        if (code === '123456' || code.length === 6) {
            errorAlert.classList.add('d-none');
            nextStep(4);
        } else {
            errorAlert.classList.remove('d-none');
        }
    }

    function downloadBackupCodes() {
        const codes = [
            '1A2B-3C4D', '5E6F-7G8H', '9I0J-1K2L', '3M4N-5O6P',
            '7Q8R-9S0T', '1U2V-3W4X', '5Y6Z-7A8B', '9C0D-1E2F'
        ];

        const content = 'MÃ DỰ PHÒNG 2FA - E-COMMERCE ADMIN\n' +
            '=====================================\n\n' +
            codes.join('\n') +
            '\n\n⚠️ Lưu trữ an toàn - Mỗi mã chỉ dùng được 1 lần';

        const blob = new Blob([content], { type: 'text/plain' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'backup-codes-2fa.txt';
        a.click();
        window.URL.revokeObjectURL(url);
    }

    function completeTwoFactorSetup() {
        document.getElementById('twoFactorSetup').style.display = 'none';
        document.getElementById('twoFactorActive').style.display = 'block';

        // Show success notification
        const alert = document.createElement('div');
        alert.className = 'alert alert-success';
        alert.innerHTML = '<i class="bi bi-check-circle me-2"></i>Xác thực hai yếu tố đã được kích hoạt thành công!';
        document.querySelector('.container-main').insertBefore(alert, document.querySelector('.page-header').nextSibling);

        setTimeout(() => alert.remove(), 5000);
    }

    function showBackupCodes() {
        const modal = new bootstrap.Modal(document.getElementById('backupCodesModal'));
        modal.show();
    }

    function disableTwoFactor() {
        if (confirm('Bạn có chắc chắn muốn tắt xác thực hai yếu tố? Tài khoản của bạn sẽ kém an toàn hơn.')) {
            document.getElementById('twoFactorActive').style.display = 'none';
            document.getElementById('twoFactorStatus').style.display = 'block';

            const alert = document.createElement('div');
            alert.className = 'alert alert-warning';
            alert.innerHTML = '<i class="bi bi-exclamation-triangle me-2"></i>Xác thực hai yếu tố đã được tắt.';
            document.querySelector('.container-main').insertBefore(alert, document.querySelector('.page-header').nextSibling);

            setTimeout(() => alert.remove(), 5000);
        }
    }

    // Auto-format verification code input
    document.getElementById('verificationCode')?.addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '');
    });

    // Privacy settings save
    document.querySelectorAll('.privacy-option .form-check-input').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const toast = document.createElement('div');
            toast.className = 'position-fixed bottom-0 end-0 p-3';
            toast.style.zIndex = '11';
            toast.innerHTML = `
                    <div class="toast show" role="alert">
                        <div class="toast-header">
                            <i class="bi bi-check-circle text-success me-2"></i>
                            <strong class="me-auto">Đã lưu</strong>
                            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                        </div>
                        <div class="toast-body">
                            Cài đặt riêng tư đã được cập nhật
                        </div>
                    </div>
                `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        });
    });
</script>
</body>
</html>